{% extends "layout.html" %} {% block content %}

<div class="container">
    <div class="row">
        <div class="col s12">
            <br><br>
            <h2>Recetario</h2>
            <ul id="tabs-swipe-demo" class="tabs">
                <li class="tab col s4 organge"><a class="active" href="#test-swipe-1">Activos</a></li>
                <li class="tab col s4"><a href="#test-swipe-2">Inactivos</a></li>
                <li class="tab col s4"><a href="#test-swipe-3">Registro</a></li>
            </ul>
            <div id="test-swipe-1">
                <div class="section">
                    <table class="responsive-table highlight centered">
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>Ingredientes</th>
                                <th>Canrtidad</th>
                                <th>Descripción</th>
                                <th>Costo</th>
                                <th>acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%for x in recetario%}
                            <tr>
                                <td>
                                    <img height="100" width="100" src="data:image/jpeg;base64,{{x.foto}}">

                                </td>
                                <td>
                                    {{x.nombre}}
                                </td>
                                <td>
                                    {{x.ingrediente}}
                                </td>
                                <td>
                                    {{x.cantidad}} g
                                </td>
                                <td>
                                    {{x.descripcion}}
                                </td>
                                <td>
                                    ${{x.costo}}
                                </td>
                                <td>
                                    <a onclick="confirmarEliminacion('{{x.id}}','{{x.nombre}}')" class="waves-effect waves-light red btn modal-trigger"> <i class="material-icons">delete</i></a>
                                    <a onclick="modal('{{x.id}}','{{x.nombre}}','{{x.descripcion}}','{{x.costo}}','{{x.foto}}')" class="waves-effect waves-light blue btn modal-trigger" href="#modal1"> <i class="material-icons">edit</i></a>
                                </td>
                            </tr>
                            {%endfor%}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="test-swipe-2">
                <table class="responsive-table highlight centered">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Nombre</th>
                            <th>Ingredientes</th>
                            <th>Cantidad</th>
                            <th>Descripción</th>
                            <th>Costo</th>
                            <th>acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%for x in recetariodesac%}
                        <tr>
                            <td>
                                <img height="100" width="100" src="{{x.foto}}">
                            </td>
                            <td>
                                {{x.nombre}}
                            </td>
                            <td>
                                {{x.ingrediente}}
                            </td>
                            <td>
                                {{x.cantidad}} g
                            </td>
                            <td>
                                {{x.descripcion}}
                            </td>
                            <td>
                                ${{x.costo}}
                            </td>
                            <td>
                                <a onclick="confirmarActivacion('{{x.id}}','{{x.nombre}}')" class="waves-effect waves-light green btn modal-trigger"> <i class="material-icons">check</i></a>
                            </td>

                            </td>
                        </tr>
                        {%endfor%}
                    </tbody>
                </table>
            </div>
            <form action="agregarRecetario" method="POST">
                <div id="test-swipe-3">
                    <div class="row">
                        <div class="col s12 center">
                            <h3><i class="mdi-content-send brown-text"></i></h3>
                            <div class="row">
                                <div class="col s12 m6 imagenes">
                                    <div class="card" style="background:black;">
                                        <div class="card-image imagenes">
                                            <img src="../../static/img/background1.jpg">
                                            <span class="card-title">Nueva Pizza</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col s12 m6 ">
                                    <div class="card">
                                        <div class="card-content">
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <i class="material-icons prefix">assignment</i>
                                                    <input class="validate" name="nombrePizza" id="nombrePizza" type="text">
                                                    <label for="text" data-error="wrong" data-success="right">Nombre</label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <i class="material-icons prefix">description</i>
                                                    <input class="validate" name="descripcionPizza" id="descripcionPizza" type="text">
                                                    <label for="desc" data-error="wrong" data-success="right">Descripción</label>
                                                </div>

                                                <div class="input-field col s6">
                                                    <i class="material-icons prefix">attach_money</i>
                                                    <input class="validate" name="costoPizza" id="costopizza" type="number">
                                                    <label for="text" data-error="wrong" data-success="right">Costo</label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <img id="imgFoto2" height="380" width="380">
                                                    <div class="file-field input-field">
                                                        <div class="btn btn-info btn-sm float-left waves-effect waves-light">
                                                            <span>File</span>
                                                            <input type="file">
                                                            <input type="file" name="txtFoto2" id="txtFoto2" class="form-control text-black" onchange="cargarFoto1();">
                                                            <textarea id="textarea" name="textarea" class="materialize-textarea" data-length="120"></textarea>
                                                        </div>
                                                        <div class="file-path-wrapper">
                                                            <input class="file-path validate" type="text">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row ">

                                                <div class="input-field col s12 ">
                                                    <select multiple  name="ingredientes" id="ingredientes">
                                                    <option value=" " disabled selected>Elegir...</option>
                                                    {%for x in ingredientes%}
                                                    <option value="{{x.id}}">{{x.nombre}}</option>
                                                    {%endfor%}
                                                  </select>
                                                    <label>Ingredientes</label>
                                                </div>
                                            </div>
                                            <div class="row ">
                                                <div class="input-field col s12 ">
                                                    <button onchange="" class="btn waves-effect waves-red orange accent-4 btn-large " type="submit " name="action ">Registrar
                                                    <i class="material-icons right ">send</i>
                                                </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Modal Structure -->
<form action="updateRecetario" method="POST">
    <div id="modal1" class="modal modal-fixed-footer">
        <div class="modal-content">
            <h4>Actualizar Materia Prima</h4>
            <div class="row">
                <div class="input-field col s12">
                    <input hidden class="validate " name="idRecetarioModal" id="idRecetario" type="text ">
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <i class="material-icons prefix">assignment</i>
                    <input class="validate" name="nombreModal" id="nombre" type="text">
                </div>
            </div>
            <div class="row ">
                <div class="input-field col s6">
                    <i class="material-icons prefix">description</i>
                    <input class="validate" name="descripcionModal" id="desc" type="text">
                </div>

                <div class="input-field col s6">
                    <i class="material-icons prefix">attach_money</i>
                    <input class="validate" name="costoModal" id="costo" type="text">
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">

                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <img id="imgFoto21" height="380" width="380">
                    <div class="file-field input-field">
                        <div class="btn btn-info btn-sm float-left waves-effect waves-light">
                            <span>File</span>
                            <input type="file" name="txtFoto2" id="txtFoto21" class="form-control text-black" onchange="cargarFoto11();">
                            
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text">
                        </div>
                    </div>
                    <textarea hidden id="textareaModal" name="textareaModal" class="materialize-textarea" data-length="120"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">

            <a class="waves-effect waves-light red btn modal-close" id="closebtn" type="submit" name="action">
                <i class="material-icons">cancel</i>
            </a>
            <button class="waves-effect waves-light green btn modal-trigger" id="updateBtn" type="submit" name="action">Actualizar
                <i class="material-icons right ">send</i>
        </div>
    </div>
</form>

<script type="text/javascript">
    function cargarFoto1() {
        var fileChooser = document.getElementById("txtFoto2");
        var foto = document.getElementById("imgFoto2");
        var base64 = document.getElementById("textarea");
        if (fileChooser.files.length > 0) {
            var fr = new FileReader();
            fr.onload = function() {
                foto.src = fr.result;
                base64.value = foto.src.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/, '');
            }
            fr.readAsDataURL(fileChooser.files[0]);
        }
    }

    function cargarFoto11() {
        var fileChooser = document.getElementById("txtFoto21");
        var foto = document.getElementById("imgFoto21");
        var base64 = document.getElementById("textareaModal");
        if (fileChooser.files.length > 0) {
            var fr = new FileReader();
            fr.onload = function() {
                foto.src = fr.result;
                base64.value = foto.src.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/, '');
            }
            fr.readAsDataURL(fileChooser.files[0]);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.modal');
        var options = {}
        var instances = M.Modal.init(elems, options);
    });

    $(document).ready(function() {
        $('ul.tabs').tabs();
    });

    function modal(idRecetario, nombre, descripcion, costo, foto) {
        $("#idRecetario").val(idRecetario);
        $("#nombre").val(nombre);
        $("#desc").val(descripcion);
        $("#costo").val(costo);
        $("#imgFoto21").attr("src", "data:image/jpeg;base64,"+foto).width(380).height(380);
        $("#textareaModal").val(foto);



        $("#updateBtn").click(function() {
            swal({
                title: "¿Quieres actualizar el Recetario?",
                text: "No se podrá deshacer esta acción",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {
                if (willDelete) {} else {}
            });
            $(".modal").removeClass("is-active");
        });
    }
    var insertarRecetario = () => {
        var ingredientes= $("#ingredientes").val();
        alert()
        };
    /*
        var insertarRecetario = () => {
            swal({
                title: "¿Quieres insertar una nueva pizza al recetario? ",
                text: "No se podrá deshacer esta acción ",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {
                if (willDelete) {
                    var nombre = $("#nombrePizza").val();
                    var costo = $("#Costopizza").val();
                    var descripcion = $("#descripcionPizza").val();
                    var foto = $("#textarea").val();
                    var ingredientes = $("#ingredientes").val();
                    window.location.href = 'agregarRecetario?nombre=' + nombre + '&' + 'descripcion=' + descripcion + '&' + 'costo=' + costo + '&' + 'foto=' + foto + '&' + 'ingredientes=' + ingredientes;
                } else {}
            });
        };
    */

    var confirmarEliminacion = (idRecetario, nombre) => {
        swal({
            title: "¿Quieres borrar " + nombre + " de la materia prima? ",
            text: "No se podrá deshacer esta acción ",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then((willDelete) => {
            if (willDelete) {
                swal("Eliminada con éxito ", {
                    icon: "success",
                });
                window.location.href = 'desactivarPizza?id=' + idRecetario;
            } else {}
        });
    };
    var confirmarActivacion = (idRecetario, nombre) => {
        swal({
            title: "¿Quieres activar la materia prima " + nombre + "? ",
            text: "No se podrá deshacer esta acción ",
            icon: "info",
            buttons: true,
            dangerMode: true,
        }).then((willDelete) => {
            if (willDelete) {
                swal("Activado con éxito ", {
                    icon: "success",
                });
                window.location.href = 'activarPizza?id=' + idRecetario;
            } else {}
        });
    };
</script>
{%endblock%}